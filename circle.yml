machine:
  php:
    version: 5.5.11
  timezone:
    America/Chicago
dependencies:
  pre:
    - echo "memory_limit = -1" > ~/.phpenv/versions/5.5.11/etc/conf.d/memory.ini
    - pecl install xdebug
  override:
    - composer install --no-interaction --optimize-autoloader --prefer-source
    - php artisan key:generate
    - php artisan migrate:install && php artisan migrate:refresh
    - php artisan db:seed
checkout:
  post:
    - cp .env.testing .env
test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) $PHPUNIT --coverage-clover build/logs/clover.xml ;; esac:
        parallel: true
    - ./vendor/bin/test-reporter
    - bash <(curl -s https://codecov.io/bash)
    - wget https://scrutinizer-ci.com/ocular.phar
    - php ocular.phar code-coverage:upload --format=php-clover build/logs/clover.xml
deployment:
  master:
    branch: master
    commands:
      - curl $FORGEDEPLOY